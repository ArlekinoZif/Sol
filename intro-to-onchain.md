---
назва: Intro to onchain development
завдання:
- Зрозуміти, як працюють ончейн-програми Solana
- Описати структуру та принцип роботи ончейн-програм
- Створити базову програму
---

# Стислий виклад

- **Ончейн-програми** — це програми, які виконуються в мережі Solana.
- Програми мають одну або кілька **обробників інструкцій**. Обробники інструкцій — це функції, які обробляють **інструкції** в транзакціях Solana.
- Обробники інструкцій записують свої дані в **акаунти** Solana, після чого транзакція або завершується успішно, або викликає помилку.
- Програми для Solana найчастіше пишуться мовою **Rust**, зазвичай з використанням фреймворку **Anchor**.
- Anchor-програми мають IDL — невеликі JSON-файли, які описують програму. IDL-файли можуть використовуватись для автоматичної генерації JS/TS-бібліотек для програми.
  
# Огляд

Кожен кластер Solana (`mainnet-beta`, `testnet`, `devnet`, `localnet`) — це, по суті, окремий комп’ютер із глобально синхронізованим станом. Програми, які працюють у мережі Solana — ті, що створюють токени, обмінюють їх, реалізують маркетплейси мистецтва, ескроу, маркетмейкерів, DePIN-додатки, аукціони, платіжні платформи для роздрібної торгівлі тощо — називаються **Solana-додатками**.

Найпопулярніший спосіб створювати ончейн-додатки — це використання мови **Rust** та фреймворку **Anchor**.

Ці фреймворки автоматично реалізують типові перевірки безпеки та виконують поширені задачі, такі як:
* перенаправлення вхідних інструкцій до відповідних обробників інструкцій
* десеріалізація даних із вхідних транзакцій
* перевірка акаунтів, наданих у вхідних інструкціях — наприклад, перевірка того, що певні акаунти є певного типу або що вони відрізняються від інших акаунтів

Незалежно від того, яку мову чи фреймворк ви оберете, принцип роботи Solana залишається однаковим. Давайте згадаємо, як працюють програми в Solana.

![Діаграма, що показує транзакцію з двома інструкціями](../assets/transaction-and-instructions.svg)

## Програми розгортаються за адресами

Так само, як ми можемо надсилати токени користувачам за їхнім публічним ключем, ми можемо знаходити програми за публічним ключем програми. Якщо ви використовуєте Anchor, пара ключів створюється під час виконання `anchor init`, а приватний ключ зберігається в директорії `target/deploy` вашого проекту.

Публічний ключ програми іноді називають 'program ID' або 'адреса програми'.

## Програми мають обробники інструкцій

Наприклад, клієнт Solana, що створює транзакцію для переказу USDC із приміткою «thanks», матиме дві інструкції:
* одну інструкцію для обробника `transfer` програми Token
* іншу інструкцію для обробника `memo` програми Memo

Обидві ці інструкції мають бути виконані успішно, щоб транзакція була здійснена.

Обробники інструкцій — це спосіб, яким блокчейн-програми обробляють інструкції від клієнтів. Кожна біржа, протокол кредитування, ескроу, оракул тощо реалізують свою функціональність через обробники інструкцій.

## Обробники інструкцій записують свій стан у акаунти Solana

Якщо ви раніше займалися веб-розробкою, можна уявити обробники інструкцій як обробники HTTP-маршрутів, а вхідні інструкції — як HTTP-запити.

Але на відміну від HTTP-обробників маршрутів, обробники інструкцій Solana не повертають дані. Замість цього вони записують свої дані у акаунти в мережі Solana.

Програми в Solana можуть переказувати токени, які потрапляють до гаманців користувачів (для SOL) або до токен-акаунтів користувачів (для інших токенів).

Але що важливіше — програми в Solana можуть створювати додаткові адреси за потреби для збереження різних даних.

## Програми зберігають дані у **Програмно Визначених Адресах (PDA)**, як у **key/value сховищі**

Дані для програм Solana зберігаються у **Програмно Визначених Адресах (PDA)**. PDA в Solana можна уявити як **key/value-сховище**:

* `key` — це адреса Програмно Визначеної Адреси (PDA), яка визначається `seeds`, обраними вами, як розробником.
 * Хочете акаунт для зберігання курсу обміну USD до AUD? Ваша програма може використати seeds `USD` та `AUD`, щоб створити Програмно Визначену Адресу
 * Хочете зберігати інформацію про взаємозв'язок двох користувачів? Ви можете використати **обидві адреси гаманців цих користувачів** як seeds, щоб створити PDA для зберігання цієї інформації
 * Хочете акаунт для зберігання рецензії Стіва на фільм "Титанік"? Ваша програма може використати **адресу гаманця Стіва** та рядок `titanic` (або, за бажанням, IMDB ID), щоб створити Програмно Визначену Адресу
 * Хочете зберігати глобальну інформацію для всієї вашої програми? Можна використати рядок на кшталт `'config'`. PDA вашої програми унікальні, тож вони не конфліктуватимуть з іншими програмами
* `value` — це дані всередині акаунту за відповідною адресою
 * Дані всередині PDA визначаються вами, як розробником

Сховища key/value дозволяють вашій ончейн-програмі та клієнтському софту послідовно визначати адресу для певного елемента даних, оскільки однакові seeds завжди повертають одну й ту ж адресу.

## Інструкції Solana мають вказувати всі акаунти, які вони використовуватимуть

Як вам уже може бути відомо, Solana є швидкою, оскільки може обробляти транзакції, які не перетинаються, одночасно. Тобто, як і в реальному світі, переказ Аліси до Боба не заважає Крісу надсилати щось Діані. Ваші фронтенд-додатки повинні вказувати адреси всіх акаунтів, які вони використовуватимуть.

Це включає й Програмно Визначені Адреси (PDA), які ви створюєте. На щастя, ви можете обчислити адресу для PDA у фронтенд-коді ще до того, як запишете туди дані!

```typescript
// There's nothing at this address right now, but we're going to use in our transaction 
const address = findProgramAddressSync(
  ['seed', 'another seed'],
  PROGRAM_ID
)
```

## Існує кілька способів розробки ончейн-програм, але ми рекомендуємо Anchor

Наразі у вас є два варіанти для розробки ончейн-програм:

* Ми рекомендуємо новачкам у ончейн-розробці [почати з Anchor](./intro-to-anchor). Стандартні налаштування Anchor дозволяють легко створювати безпечні програми.
* У цьому курсі також розглядається [розробка нативних ончейн-програм](./hello-world-program).

Який би варіант ви не обрали, Solana Foundation підтримує [приклади обома способами](https://github.com/solana-developers/program-examples), а [Solana Stack Exchange](https://solana.stackexchange.com/) завжди готовий допомогти.

А поки — давайте [налаштуємо ваш комп’ютер](./local-setup)!
